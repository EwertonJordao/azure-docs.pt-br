---
title: Avaliação de Vulnerabilidades SQL
description: Saiba como configurar a Avaliação de Vulnerabilidade do SQL no Banco de Dados SQL e interpretar os relatórios de avaliação.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 02/05/2020
tags: azure-synapse
ms.openlocfilehash: 87f3c4b0489c48f758ce9e660bdfd599c086b677
ms.sourcegitcommit: 225a0b8a186687154c238305607192b75f1a8163
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/29/2020
ms.locfileid: "78191972"
---
# <a name="sql-vulnerability-assessment-service-helps-you-identify-database-vulnerabilities"></a>O serviço de Avaliação de Vulnerabilidades do SQL ajuda a identificar vulnerabilidades de banco de dados

A Avaliação de Vulnerabilidade do SQL é um serviço fácil de ser configurado que pode descobrir, acompanhar e ajudá-lo a corrigir vulnerabilidades potenciais do banco de dados. Use-a para melhorar de forma proativa a segurança do seu banco de dados.

A Avaliação de Vulnerabilidade faz parte da oferta da [ADS (segurança de dados avançada)](sql-database-advanced-data-security.md), um pacote unificado para funcionalidades avançadas de segurança do SQL. A Avaliação de Vulnerabilidade pode ser acessada e gerenciada por meio do portal central da ADS do SQL.

> [!NOTE]
> Há suporte para avaliação de vulnerabilidade no banco de dados SQL do Azure, Azure SQL Instância Gerenciada e Azure Synapse Analytics. Para simplificar, o Banco de Dados SQL é usado neste artigo para se referir a qualquer um desses serviços de banco de dados gerenciado.

## <a name="the-vulnerability-assessment-service"></a>O serviço de Avaliação de Vulnerabilidades

A Avaliação de vulnerabilidade de SQL (VA) é um serviço que fornece visibilidade sobre o estado de segurança e inclui etapas acionáveis para resolver problemas de segurança e aperfeiçoar a segurança de banco de dados. Ela pode ajudar você a:  

- Atender aos requisitos de conformidade que exigem relatórios de verificação de banco de dados.  
- Atender aos padrões de privacidade de dados.  
- Monitorar um ambiente de banco de dados dinâmico, onde as alterações são difíceis de rastrear.  

Avaliação de Vulnerabilidades é um serviço de verificação incorporado ao serviço Banco de Dados SQL do Azure. O serviço emprega uma base de conhecimento de regras que sinalizam vulnerabilidades de segurança e realçam desvios das práticas recomendadas, como configurações incorretas, excesso de permissões e dados confidenciais sem proteção. As regras se baseiam nas melhores práticas da Microsoft e enfocam os problemas de segurança que apresentam os maiores riscos para o banco de dados e seus dados importantes. Elas abordam problemas no nível do banco de dados, bem como problemas de segurança no nível do servidor, como configurações de firewall do servidor e permissões no nível do servidor. Essas regras também representam muitos dos requisitos de várias agências regulatórias para atender aos seus padrões de conformidade.  

Os resultados da verificação incluem etapas práticas para resolver cada problema e fornecer scripts de correções personalizadas quando aplicável. Um relatório de avaliação pode ser personalizado para seu ambiente com a definição de uma linha de base aceitável para configurações de permissão, configurações de recurso e configurações de banco de dados.

## <a name="implementing-vulnerability-assessment"></a>Implementar a Avaliação de Vulnerabilidades

As etapas a seguir implementam a VA no Banco de dados SQL do Microsoft Azure.  

### <a name="1-run-a-scan"></a>1. executar uma verificação  

Comece a usar a VA navegando para **Segurança de Dados Avançada** no cabeçalho Segurança do painel do Banco de Dados SQL do Azure. Clique para habilitar a segurança de dados avançada e clique no cartão **Selecionar Armazenamento** ou no cartão de **Avaliação de Vulnerabilidade**, que automaticamente abre o cartão de configurações da Avaliação de Vulnerabilidade para todo o SQL Server.

Comece configurando uma conta de armazenamento na qual os resultados da verificação de todos os bancos de dados no servidor serão armazenados. Para saber mais sobre as contas de armazenamento, confira [Sobre as contas de armazenamento do Azure](../storage/common/storage-create-storage-account.md). Depois que o armazenamento é configurado, clique em **Verificar** para verificar seu banco de dados quanto a vulnerabilidades.
  
![Examinar um banco de dados](./media/sql-vulnerability-assessment/pp_va_initialize.png)  

  > [!NOTE]
  > A verificação é leve e segura. Ela leva alguns segundos para ser executada e é completamente de somente leitura. Ela não faz nenhuma alteração no banco de dados.  

### <a name="2-view-the-report"></a>2. exibir o relatório

Quando a verificação estiver concluída, o relatório de verificação será automaticamente exibido no portal do Azure. O relatório apresenta uma visão geral do estado de segurança: quantos problemas foram encontrados e suas respectivas severidades. Os resultados incluem avisos sobre desvios das melhores práticas e um instantâneo das configurações relacionadas à segurança, como funções e entidades de segurança de banco de dados e suas permissões associadas. O relatório de verificação também fornece um mapa dos dados confidenciais descobertos no banco de dados e inclui recomendações para classificar esses dados usando a [descoberta e classificação de dados](sql-database-data-discovery-and-classification.md).

![Exibir o relatório](./media/sql-vulnerability-assessment/pp_main_getstarted.png)  

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. analisar os resultados e resolver problemas

Examine os resultados e determine quais conclusões no relatório são problemas de segurança reais em seu ambiente. Faça uma busca detalhada de cada resultado com falha para entender o impacto da conclusão e o motivo da falha de cada verificação de segurança. Use as informações de correção acionáveis fornecidas pelo relatório para resolver o problema.  

![Analisar o relatório](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. definir sua linha de base

Ao examinar os resultados da avaliação, marque resultados específicos como sendo uma *Linha de base* aceitável em seu ambiente. A linha de base é essencialmente uma personalização de como os resultados são registrados. Os resultados que correspondem à linha de base são considerados ao passar nas verificações posteriores. Depois de estabelecer o estado de segurança de linha de base, o VA relata somente os desvios da linha de base e você pode concentrar sua atenção nos problemas relevantes.  

![Definir a linha de base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)  

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. executar uma nova verificação para ver o relatório de acompanhamento personalizado

Depois de concluir a configuração das **Linhas de Base da Regra**, execute uma nova verificação para exibir o relatório personalizado. A VA agora relata apenas os problemas de segurança que sejam diferentes do seu estado de linha de base aprovado.

![Exibir o relatório personalizado](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)  

A Avaliação de Vulnerabilidades agora pode ser usada para monitorar se o banco de dados mantém um alto nível de segurança em todos os momentos e se as políticas organizacionais são atendidas. Se os relatórios de conformidade forem necessários, os relatórios da AV podem ser úteis para facilitar o processo de conformidade.  

### <a name="6-set-up-periodic-recurring-scans"></a>6. Configurar verificações recorrentes periódicas

Navegue para as configurações da Avaliação de Vulnerabilidade para ativar **Verificações recorrentes periódicas**. Isso configura a Avaliação de Vulnerabilidade para executar automaticamente uma verificação no banco de dados uma vez por semana. Um resumo dos resultados da verificação será enviado aos endereços de email fornecidos.

![Exibir o relatório personalizado](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. exportar um relatório de avaliação

Clique em **Exportar Resultados da Verificação** para criar um relatório do Excel para download do resultado da verificação. Esse relatório contém uma guia de resumo que exibe um resumo da avaliação, incluindo todas as verificações com falha. Também inclui uma guia **Resultados** que contém o conjunto completo dos resultados da verificação, incluindo todas as verificações que foram executadas e os detalhes do resultado de cada uma.

### <a name="8-view-scan-history"></a>8. exibir histórico de verificação

Clique em **Histórico de Verificação** no painel do VA para exibir um histórico de todas as verificações executadas anteriormente nesse banco de dados. Selecione uma verificação específica na lista para exibir os resultados detalhados dessa verificação.

A Avaliação de Vulnerabilidades agora pode ser usada para monitorar se o banco de dados mantém um alto nível de segurança em todos os momentos e se as políticas organizacionais são atendidas. Se os relatórios de conformidade forem necessários, os relatórios da AV podem ser úteis para facilitar o processo de conformidade.

## <a name="manage-vulnerability-assessments-using-azure-powershell"></a>Gerenciar Avaliações de Vulnerabilidade usando o Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> O módulo Azure Resource Manager do PowerShell ainda tem suporte do banco de dados SQL do Azure, mas todo o desenvolvimento futuro é para o módulo AZ. Sql. Para esses cmdlets, consulte [AzureRM. SQL](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Os argumentos para os comandos no módulo AZ e nos módulos AzureRm são substancialmente idênticos.

Você pode usar os cmdlets do Microsoft Azure PowerShell para gerenciar suas avaliações de vulnerabilidade de forma programática. Os cmdlets com suporte são:

- [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting)

  Atualiza as configurações de avaliação de vulnerabilidades de um banco de dados
- [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting)

  Retorna as configurações de avaliação de vulnerabilidades de um banco de dados
- [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting)

  Limpa as configurações de avaliação de vulnerabilidades de um banco de dados
- [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Define a linha de base da regra de avaliação de vulnerabilidades.
- [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Obtém a linha de base da regra de avaliação de vulnerabilidades para uma determinada regra.
- [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Limpa a linha de base da regra de avaliação de vulnerabilidades. Primeiro, defina a linha de base antes de usar este cmdlet para limpá-lo.
- [Start-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan)

  Dispara o início de uma verificação de avaliação de vulnerabilidades
- [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord)

   Obtém todos os registros de verificação de avaliação de vulnerabilidade associados a um determinado banco de dados.
- [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan)

  Converte resultados de verificação de avaliação de vulnerabilidades em um arquivo do Excel

Para obter um exemplo de script, consulte [suporte do PowerShell de Avaliação de Vulnerabilidade de SQL do Azure](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/).

## <a name="manage-vulnerability-assessments-baseline-rules-using-resource-manager-templates"></a>Gerenciar regras de linha de base de avaliação de vulnerabilidade usando modelos do Resource Manager

Para configurar as linhas de base de avaliação de vulnerabilidade usando modelos de Azure Resource Manager, use o tipo `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`.

Verifique se você habilitou o vulnerabilityAssements no computador que está executando o SQL Server antes de adicionar linhas de base.

Aqui está um exemplo para definir a regra de linha de base VA2065 para masterdb e VA1143 das como recursos em um modelo do Resource Manager:

```json
    "resources": [
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                                "FirewallRuleName3",
                                "StartIpAddress",
                                "EndIpAddress"
                                  ]
                    },{
                         "result": [
                                "FirewallRuleName4",
                                "62.92.15.68",
                                "62.92.15.68"
                            ]
                        
                    }
                ]
            },
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "dbo"
                        ]
                    }
                ]
            }
        }
    ]
}   
```

Para banco de dados de usuário e banco de dados mestre, os nomes de recursos são definidos de forma diferente:

* Banco de dados mestre-"Name": "[Concat (Parameters (' server_name '), '/', Parameters (' database_name '), '/default/VA2065/<b>Master</b>')]",
* User Database-"Name": "[Concat (Parameters (' server_name '), '/', Parameters (' database_name '), '/default/VA2065/<b>Default</b>')]",
 
 
 Para tratar tipos <b>booleanos</b> como true/false, defina o resultado da linha de base com a entrada binária, como "1"/"0".
 
 ```json
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "1"
                        ]
                    }
                ]
            }
        }
    ]
}   
```
 
 
## <a name="next-steps"></a>Próximas etapas  

- Saiba mais sobre a [segurança de dados avançada](sql-database-advanced-data-security.md)
- Saiba mais sobre [descoberta e classificação de dados](sql-database-data-discovery-and-classification.md)

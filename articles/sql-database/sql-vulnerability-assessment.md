---
title: Avaliação de Vulnerabilidades SQL
description: Saiba como configurar a avaliação de vulnerabilidade sql no banco de dados SQL do Azure e interprete os relatórios de avaliação.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 02/05/2020
tags: azure-synapse
ms.openlocfilehash: a54cbb017e85ec10e142ffae8981bc839aac37f4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/28/2020
ms.locfileid: "80061655"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>A avaliação de vulnerabilidades do SQL ajuda a identificar vulnerabilidades do banco de dados

O SQL Vulnerability Assessment é um serviço fácil de configurar que pode descobrir, rastrear e ajudá-lo a corrigir possíveis vulnerabilidades no banco de dados. Use-a para melhorar de forma proativa a segurança do seu banco de dados.

A Avaliação de Vulnerabilidades faz parte da oferta de Segurança Avançada de [Dados,](sql-database-advanced-data-security.md) que é um pacote unificado para recursos avançados de segurança SQL. A Avaliação de Vulnerabilidades pode ser acessada e gerenciada através do portal central SQL Advanced Data Security.

> [!NOTE]
> A Avaliação de Vulnerabilidades é suportada para o Banco de Dados SQL do Azure, a instância gerenciada do Banco de Dados SQL do Azure e o Azure Synapse Analytics. Para simplificar, o Banco de Dados SQL é usado neste artigo para se referir a qualquer um desses serviços de banco de dados gerenciado.

## <a name="vulnerability-assessment"></a>Avaliação de Vulnerabilidade

SQL Vulnerability Assessment é um serviço que fornece visibilidade ao seu estado de segurança. A Avaliação de Vulnerabilidades inclui etapas acionáveis para resolver problemas de segurança e melhorar a segurança do banco de dados. Ela pode ajudar você a: 

- Atender aos requisitos de conformidade que exigem relatórios de verificação de banco de dados.
- Atender aos padrões de privacidade de dados.
- Monitorar um ambiente de banco de dados dinâmico, onde as alterações são difíceis de rastrear.

Avaliação de vulnerabilidades é um serviço de digitalização incorporado ao Banco de Dados SQL do Azure. O serviço emprega uma base de conhecimento de regras que sinalizam vulnerabilidades de segurança. Ele destaca desvios de práticas recomendadas, como configurações erradas, permissões excessivas e dados confidenciais desprotegidos.

As regras são baseadas nas melhores práticas da Microsoft e se concentram nos problemas de segurança que apresentam os maiores riscos para o seu banco de dados e seus dados valiosos. Eles cobrem problemas de nível de banco de dados e problemas de segurança no nível do servidor, como configurações de firewall do servidor e permissões em nível de servidor. Essas regras também representam muitos dos requisitos de várias agências regulatórias para atender aos seus padrões de conformidade.

Os resultados da verificação incluem etapas práticas para resolver cada problema e fornecer scripts de correções personalizadas quando aplicável. Você pode personalizar um relatório de avaliação para o seu ambiente definindo uma linha de base aceitável para:
* Configurações de permissão.
* Configurações de recursos.
* Configurações do banco de dados.

## <a name="implement-vulnerability-assessment"></a>Implementar avaliação de vulnerabilidades

As etapas a seguir implementam a Avaliação de Vulnerabilidade no Banco de Dados SQL.

### <a name="1-run-a-scan"></a>1. Execute uma varredura

No painel do Banco de Dados SQL do Azure, sob o título **Segurança,** selecione **Segurança avançada de dados**. Em seguida, clique em **Selecionar armazenamento** no painel Avaliação **de vulnerabilidadepara** abrir o painel de configurações de avaliação de vulnerabilidade para todo o servidor SQL.

Configure uma conta de armazenamento onde os resultados da varredura de todos os bancos de dados no servidor serão armazenados. Para saber mais sobre as contas de armazenamento, confira [Sobre as contas de armazenamento do Azure](../storage/common/storage-create-storage-account.md). Depois que o armazenamento estiver configurado, selecione **Scan** para escanear seu banco de dados para obter vulnerabilidades.

![Examinar um banco de dados](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > A verificação é leve e segura. Leva alguns segundos para ser executado e é totalmente somente leitura. Não faz alterações no seu banco de dados.

### <a name="2-view-the-report"></a>2. Ver o relatório

Quando a varredura é concluída, seu relatório de varredura é exibido automaticamente no portal Azure. O relatório apresenta uma visão geral do seu estado de segurança. Ele lista quantos problemas foram encontrados e suas respectivas gravidades. Os resultados incluem avisos sobre desvios de práticas recomendadas e um instantâneo de suas configurações relacionadas à segurança, como diretores e funções de banco de dados e suas permissões associadas. O relatório de varredura também fornece um mapa de dados confidenciais descobertos em seu banco de dados. Inclui recomendações para classificar esses dados usando [a detecção e classificação de dados](sql-database-data-discovery-and-classification.md).

![Exibir o relatório](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Analise os resultados e resolva problemas

Examine os resultados e determine quais conclusões no relatório são problemas de segurança reais em seu ambiente. Faça uma busca detalhada de cada resultado com falha para entender o impacto da conclusão e o motivo da falha de cada verificação de segurança. Use as informações de correção acionáveis fornecidas pelo relatório para resolver o problema.

![Analisar o relatório](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. Defina sua linha de base

Ao revisar os resultados de sua avaliação, você pode marcar resultados específicos como sendo uma *linha de base* aceitável em seu ambiente. A linha de base é essencialmente uma personalização de como os resultados são registrados. Os resultados que correspondem à linha de base são considerados ao passar nas verificações posteriores. Depois de estabelecer seu estado de segurança de linha de base, a Avaliação de Vulnerabilidades só reporta desvios da linha de base. Desta forma, você pode concentrar sua atenção nas questões relevantes.

![Definir a linha de base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Execute uma nova varredura para ver seu relatório de rastreamento personalizado

Depois de terminar de configurar suas **linhas de base de regras,** execute uma nova varredura para exibir o relatório personalizado. A Avaliação de Vulnerabilidades agora relata apenas os problemas de segurança que se desviam do estado de linha de base aprovado.

![Exibir o relatório personalizado](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

A Avaliação de Vulnerabilidades agora pode ser usada para monitorar se o banco de dados mantém um alto nível de segurança em todos os momentos e se as políticas organizacionais são atendidas. Se os relatórios de conformidade forem necessários, os relatórios de avaliação de vulnerabilidades podem ser úteis para facilitar o processo de conformidade.

### <a name="6-set-up-periodic-recurring-scans"></a>6. Configure varreduras recorrentes periódicas

Vá às configurações de avaliação de vulnerabilidadepara ativar **varreduras recorrentes periódicas**. Essa configuração configura avaliação de vulnerabilidadepara executar automaticamente uma varredura no banco de dados uma vez por semana. Um resumo do resultado da varredura é enviado para os endereços de e-mail fornecidos.

![Exibir o relatório personalizado](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Exportar um relatório de avaliação

Selecione **Exportar resultados de varredura** para criar um relatório Excel para download do resultado da varredura. Este relatório contém uma guia de resumo que exibe um resumo da avaliação. O relatório inclui todas as verificações reprovadas. Ele também inclui uma guia **Resultados** que contém o conjunto completo de resultados da varredura. Os resultados incluem todas as verificações que foram executadas e os detalhes do resultado para cada um.

### <a name="8-view-scan-history"></a>8. Ver histórico de varredura

Selecione **O histórico de varredura** no painel Avaliação de vulnerabilidades para exibir um histórico de todas as varreduras executadas anteriormente neste banco de dados. Selecione uma verificação específica na lista para exibir os resultados detalhados dessa verificação.

A Avaliação de Vulnerabilidades agora pode ser usada para monitorar se o banco de dados mantém um alto nível de segurança em todos os momentos e se as políticas organizacionais são atendidas. Se os relatórios de conformidade forem necessários, os relatórios de avaliação de vulnerabilidades podem ser úteis para facilitar o processo de conformidade.

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>Gerencie avaliações de vulnerabilidadeusando o Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> O módulo PowerShell Azure Resource Manager ainda é suportado pelo Banco de Dados SQL do Azure, mas todo o desenvolvimento futuro é para o módulo Az.Sql. Para obter esses cmdlets, consulte [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Os argumentos para os comandos no módulo Az e nos módulos AzureRm são substancialmente idênticos.

Você pode usar os cmdlets do Microsoft Azure PowerShell para gerenciar suas avaliações de vulnerabilidade de forma programática. Os cmdlets com suporte são:

- [Configuração de vulnerabilidade do Update-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting)

  Atualiza as configurações de avaliação de vulnerabilidade de um banco de dados.
- [Get-AzSqlDatabaseVulnerabilityAssessmentAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting)

  Retorna as configurações de avaliação de vulnerabilidade de um banco de dados.
- [Definição de vulnerabilidade do Clear-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting)

  Limpa as configurações de avaliação de vulnerabilidade de um banco de dados.
- [Set-AzSqlDatabaseVulnerabilidadeAvaliaçãoRegraRegra](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Define a linha de base da regra de avaliação de vulnerabilidades.
- [Get-AzSqlDatabaseVulnerabilidadeassessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Obtém a linha de base da regra de avaliação de vulnerabilidades para uma determinada regra.
- [Clear-AzSqlDatabaseVulnerabilidadeAvaliaçãoRegraRegra](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Limpa a linha de base da regra de avaliação de vulnerabilidades. Primeiro, defina a linha de base antes de usar este cmdlet para limpá-lo.
- [Start-AzSqlDatabaseVulnerabilidadeAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan)

  Aciona o início de uma varredura de avaliação de vulnerabilidades.
- [Get-AzSqlDatabaseVulnerabilidadeAssessmentAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord)

   Obtém todos os registros de verificação de avaliação de vulnerabilidade associados a um determinado banco de dados.
- [Convert-AzSqlDatabaseAvaliaçãoVulnerabilidadeScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan)

  Converte os resultados da varredura de avaliação de vulnerabilidade scan em um arquivo Excel.

Para obter um exemplo de script, consulte [suporte do PowerShell de Avaliação de Vulnerabilidade de SQL do Azure](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/).

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>Gerenciar as regras da linha de base da Avaliação de Vulnerabilidades usando modelos do Gerenciador de recursos

Para configurar as linhas de base da Avaliação de Vulnerabilidades `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` usando modelos do Azure Resource Manager, use o tipo.

Certifique-se de `vulnerabilityAssessments` que você habilitou no computador que está executando o SQL Server antes de adicionar linhas de base.

Aqui está um exemplo para definir a regra de linha de base VA2065 para masterdb e VA1143 para userdb como recursos em um modelo de Gerenciador de recursos:

```json
    "resources": [
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                                "FirewallRuleName3",
                                "StartIpAddress",
                                "EndIpAddress"
                                  ]
                    },{
                         "result": [
                                "FirewallRuleName4",
                                "62.92.15.68",
                                "62.92.15.68"
                            ]
                        
                    }
                ]
            },
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "dbo"
                        ]
                    }
                ]
            }
        }
    ]
}   
```

Para banco de dados mestre e banco de usuário, os nomes dos recursos são definidos de forma diferente:

* Banco de dados mestre - "nome": "[concat('server_name'),'/', parâmetros ('database_name') , '/default/VA2065/<b>master</b>')",
* Banco de dados do usuário - "nome": "[concat('server_name'),'/', parâmetros ('database_name') , '/default/VA2065/<b>default</b>')","
 
 
 Para lidar com os tipos booleanos como verdadeiros/falsos, defina o resultado da linha de base com entrada binária como "1"/"0".
 
 ```json
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "1"
                        ]
                    }
                ]
            }
        }
    ]
}   
```
 
 
## <a name="next-steps"></a>Próximas etapas  

- Saiba mais sobre [o Advanced Data Security](sql-database-advanced-data-security.md).
- Saiba mais sobre [a descoberta e classificação de dados](sql-database-data-discovery-and-classification.md).

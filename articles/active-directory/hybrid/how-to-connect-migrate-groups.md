---
title: 'Azure AD Connect: migre grupos de uma floresta para outra | Microsoft Docs'
description: Este artigo descreve os passos necessários para migrar com sucesso grupos de uma floresta para outra para o Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: reference
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 602c60de392afbff18bc141605a936636e48dbfe
ms.sourcegitcommit: ffc6e4f37233a82fcb14deca0c47f67a7d79ce5c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/21/2020
ms.locfileid: "81729698"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Migrar grupos de uma floresta para outra para o Azure AD Connect

Este artigo descreve os passos necessários para migrar com sucesso grupos de uma floresta para outra, de modo que os objetos de grupo migrados correspondam aos objetos existentes na nuvem.

## <a name="prerequisites"></a>Pré-requisitos

- Azure AD Connect versão 1.5.18.0 ou superior
- Atributo De âncora de origem é`mS-DS-ConsistencyGuid`

A partir da versão 1.5.18.0, o Azure `mS-DS-ConsistencyGuid` AD Connect começou a suportar o uso de grupos. Se `mS-DS-ConsistencyGuid` for escolhido como o atributo de âncora de origem e o valor for `mS-DS-ConsistencyGuid` preenchido em AD, o Azure AD Connect usará o valor de como imutávelId. Caso contrário, ele volta `objectGUID`a usar . No entanto, observe que o **DOES NOT** Azure AD `mS-DS-ConsistencyGuid` Connect NÃO reescreve o valor para o atributo no AD.

Durante um cenário de movimento transfronteiriço onde um objeto de grupo está se movendo de uma floresta (digamos `mS-DS-ConsistencyGuid` F1) para `objectGUID` outra floresta (digamos F2), precisaremos copiar sobre o valor (Se PRESENTE) ou o valor do objeto na floresta F1 para o atributo `mS-DS-ConsistencyGuid` do objeto em F2. 

Por favor, use os seguintes scripts como diretriz para ver como você pode migrar um único grupo da floresta F1 para a floresta F2. Por favor, sinta-se livre para usar isso como uma diretriz para fazer a migração para vários grupos.

Primeiro, temos `objectGUID` o `mS-DS-ConsistencyGuid` objeto e do grupo na floresta F1. Esses atributos são exportados para um arquivo CSV.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to Export-Group script
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Em seguida, usamos o arquivo CSV `mS-DS-ConsistencyGuid` de saída gerada para carimbar o atributo no objeto-alvo na floresta F2.


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by Import-Group script
It copies either the objectGUID or mS-DS-ConsistencyGuid value from CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Próximas etapas
Saiba mais sobre [a integração de suas identidades no local com o Azure Active Directory](whatis-hybrid-identity.md).
